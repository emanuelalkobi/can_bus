# CAN bus 2.0A
can_bus 2.0A software transmission emulation.

**The code was implemented and tested over mac OS Mojave version 10.14.6**

based on the next pages:
- http://socialledge.com/sjsu/index.php/DBC_Format
- https://en.wikipedia.org/wiki/CAN_bus#Frames

**Input parameters to the program**

- STRESS_FACTOR = 1.0 - 20.0
This parameter is used as multiplier to the above table values, in order to perform stress test
Default value: [1.0]

- DRIVE_SESSION_TIME = 1.0 sec – 30 min
Drive session emulation time. The program should run and generate the messages in a cyclic way with the:
TX_FREQUENCY * STRESS_FACTOR * DRIVE_SESSION_TIME in seconds, until the duration is reached.
Default value - [10 minutes]


**Data frame**

The data frame format in CAN bus 2.0A has the next structure:

- Start-of-frame [1]	Denotes the start of frame transmission
- Identifier (green)	11	A (unique) identifier which also represents the message priority
- Remote transmission request (RTR) (blue)	1	Must be dominant (0) for data frames and recessive (1) for remote request frames (see Remote Frame, below)
Identifier extension bit (IDE)	1	Must be dominant (0) for base frame format with 11-bit identifiers
- Reserved bit (r0)	1	Reserved bit. Must be dominant (0), but accepted as either dominant or recessive.
- Data length code (DLC) (yellow)	4	Number of bytes of data (0–8 bytes)[a]
- Data field (red)	0–64 (0-8 bytes)	Data to be transmitted (length in bytes dictated by DLC field)
- CRC	15	Cyclic redundancy check
- CRC delimiter	1	Must be recessive (1)
- ACK slot	1	Transmitter sends recessive (1) and any receiver can assert a dominant (0)
- ACK delimiter	1	Must be recessive (1)
- End-of-frame (EOF)	7	Must be recessive (1)


**Message types**

In this emulation there are only 3 type of messages:

1.**wheel_speeds**
- id:464
- data size : 8 bytes
- frequency:100 hz

**2.brake_module**
- id:446
- data size : 3 bytes
- frequency:10 hz

**3.powertrain_data:**
- id:380
- data size : 8 bytes
- frequency:25 hz

**Algorith**
The CAN bus work in the next way:
There are 3 queues for each message type.

The message are generated by thier frequency as explained before and each message is inserted to the relevant queue.

As the CAN bus is free(no other message is transmited over it  ) it tries to send a message by the next priorty:

1.powertrain

2.break module

3.wheel speeds


**Inputs**
The user can set the next parameters:

1.simulation time in seconds between 0 to 1800 seconds(0 to 30 minutes). default value is 600 seconds(10 minutes)

2.strees value between 1 to 20 .default value is 1.

This parameter is used as multiplier to the message frequencies.

**Output**

2 files are generated during the simulation

1.sent_message.txt

this file has the next information

<time stamp in usec> message type message message data
  
2.summary_report.txt
  
This file has the next stats about the simulation:
1.number of sent message over the CAN bus
  
2.number of queued message over the CAN bus
  
3.warning in a case that there are some queued message when the simulation ends
  
4.jitter value per message types
  
5.avergae bandwidth











